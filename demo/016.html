<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="content">
    <canvas id="c"></canvas>
  </div>
  <script type="module">
import * as LMGL from '../src/LMGL.js';
window.LMGL = LMGL;
// THREE.ACESFilmicToneMapping
// webgl_tonemapping.html Tone Mapping

const vertexShader = `
  precision mediump float;
  attribute vec3 aPosition;

  attribute vec4 aColor;
	varying vec4 vColor;

  uniform mat4 projectionMatrix;
  uniform mat4 modelViewMatrix;


  void main() {
   gl_Position = projectionMatrix * modelViewMatrix * vec4(aPosition, 1.0);
    vColor = aColor;
  }
`

const fragmentShader = `
  precision mediump float;
	varying vec4 vColor;
  ${LMGL.modules.toneMapping}

	void main() {
	  gl_FragColor = vColor;
    vec3 color = vec3( gl_FragColor.xyz);
    CustomToneMapping(color);
    gl_FragColor.xyz = color;
	}
	`

let stage

window.onload = () => {
  document.title = "色调映射"
  const width = window.innerWidth
  const height = window.innerHeight

  stage = new LMGL.Stage()
  stage.init(document.querySelector("#c"), width, height)
  stage.camera.position.set(0, 0, 5)

  // new LMGL.Axis(100, stage)

  const z = 0;
  const geo = {
    indices: [0, 1, 2],
    attribute: {
      aPosition: {
          value: [
           0, 1, z,
           -1., -0.5, z,
           1., -0.5, z
          ],
          itemSize: 3
        },
        aColor: {
          value: [
            1, 0., 0, 1,
            0., 1, 0., 1,
            0., 0., 1, 1,
          ],
          itemSize: 4
        }
    }
  };

  const matInfo = {
    vertexShader,
    fragmentShader,
    uniforms: {
      toneMappingExposure: {
        type: "f",
        value: "1"
      }
    }
  }

  const mat = new LMGL.Material(matInfo);
  let mesh = new LMGL.Mesh(geo, mat);
  stage.addUpdate("loop",()=>{
    // mesh.rotation.y += 0.01;
  })
  stage.add(mesh)
  stage.run()
}

  </script>
</body>
</html>
