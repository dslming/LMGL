<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="content">
    <canvas id="c"></canvas>
  </div>
  <script type="module">
    // https://math.hws.edu/graphicsbook/source/webgl/cube-camera.html
    import * as lmgl from '../src/lmgl.js'
    window.lmgl = lmgl;

    /************* shader program for the skybox ******************/
  let stage

  // 平面
  class Plane {
    constructor(url, stage, pos) {
      this.init(url, stage, pos)
    }

    async init(url, stage, pos) {
      const img = await lmgl.loadImage(url);
      let imageTexture = new lmgl.ImageTexture(img)

      // 平面
      const vsPlane = `
        precision mediump float;
        attribute vec3 aPosition;
        attribute vec2 aUv;
        varying vec2 vUv;
        uniform mat4 projectionMatrix;
        uniform mat4 modelViewMatrix;

        void main() {
          vUv = aUv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(aPosition, 1.0);
        }
      `

      const fsPlane = `
        precision mediump float;
        uniform sampler2D texture;
        uniform sampler2D uTexture;
        varying vec2 vUv;

        void main() {
          gl_FragColor = texture2D(uTexture, vec2(vUv.x, vUv.y));
        }
        `

      const dataModel = lmgl.geometryLib.plane(2);
      const geoInfo = {
        attribute: {
          aPosition: {
            value: dataModel.position,
            itemSize: 3
          },
          aNormal: {
            value: dataModel.normal,
            itemSize: 3
          },
          aUv: {
            value: dataModel.uv,
            itemSize: 2,
          }
        },
        indices: dataModel.indices
      };

      const matInfo = {
        vertexShader: vsPlane,
        fragmentShader: fsPlane,
        uniforms: {
          uTexture: {
            value: imageTexture.getTexture(),
            type: "t"
          }
        }
      }
      const mat = new lmgl.Material(matInfo);
      this.mesh = new lmgl.Mesh(geoInfo, mat);
      this.mesh.material.imageTexture = imageTexture
      this.mesh.material.needUpdate = true;
      this.mesh.position.x = pos.x;
      stage.add(this.mesh);
    }
  }

  window.onload = () => {
    document.title = "两个模型, 两个纹理"
    let width = window.innerWidth
    let height = window.innerHeight

    window.addEventListener("resize", ()=>{
      width = window.innerWidth
      height = window.innerHeight
    })

    stage = new lmgl.Stage()
    stage.init(document.querySelector("#c"), width, height)
    stage.camera.position.set(0, 0, 10)
    const plane1 = new Plane("./images/colors.png", stage, {x: -3.5});
    const plane2 = new Plane("./images/test.png", stage, {x: 1.8});
    window.stage  = stage;

    stage.run()
  }

  </script>
</body>
</html>
