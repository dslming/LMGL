<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="content">
    <canvas id="c"></canvas>
  </div>
  <script type="module">
    import * as LMGL from '../src/LMGL.js'
    window.LMGL = LMGL;

    const vertexShader = `#version 300 es
  precision mediump float;
  in vec3 aPosition;
  in vec3 aNormal;

	out vec3 vNormal;
	out vec3 vPositionW;

  uniform mat4 projectionMatrix;
  uniform mat4 modelViewMatrix;
  uniform mat4 world;

  void main() {
   vNormal = aNormal;
   gl_Position = projectionMatrix * modelViewMatrix * vec4(aPosition, 1.0);
   vPositionW = vec3(world * vec4(aPosition, 1.0));
  }
`

const fragmentShader = `#version 300 es
  precision mediump float;
	uniform vec3 uDiffuse;
  uniform mat3 normalMatrix;
  uniform vec3 vEyePosition;
	in vec3 vNormal;
  in vec3 vPositionW;
  out vec4 FragColor;

  ${LMGL.modules.hemisphereLight}


	void main() {
    vec3 normal = normalize(normalMatrix * vNormal);
    vec3 viewDirectionW = normalize(vEyePosition-vPositionW);
    LightInfo lightInfo = getHemisphereLightIrradiance(
      viewDirectionW,
      normal,
      hemisphereLight);
    vec3 diffuse = clamp(lightInfo.diffuse, 0., 1.);
    vec3 specular = clamp(lightInfo.specular, 0., 1.);
	  FragColor = vec4(diffuse + specular, 1.);
	}
	`

let stage

window.onload = () => {
  document.title = "半球光"
  const width = window.innerWidth
  const height = window.innerHeight

  stage = new LMGL.Stage()
  stage.init(document.querySelector("#c"), width, height)
  stage.camera.position.set(0, 0, 10)

  const model = LMGL.geometryLib.sphere(1.5);
  const geo = {
    indices: model.indices,
    attribute: {
      aPosition: {
        value: model.position,
        itemSize: 3
      },
      aNormal:{
        value: model.normal,
        itemSize: 3
      }
    }
  };

  const matInfo = {
    vertexShader,
    fragmentShader,
    uniforms: {
      uDiffuse: {type:"v3", value: {x:0,y:1,z:0}},
      HemisphereLight: {
        type: "struct",
        value: {
          direction: {
            type: "v3",
            value: {x: -1,y:1,z:0},
          },
          skyColor: {
            type: "v3",
            value: {x: 1,y:0,z:0},
          },
          groundColor: {
            type: "v3",
            value: {x: 0,y:1,z:0},
          },
          specularColor: {
            type: "v4",
            value: {x: 1,y:1,z:1,w: 64},
          }
        }
      }
    }
  }
    // const matInfo = {
    //   vertexShader,
    //   fragmentShader,
    //   uniforms: {
    //     uDiffuse: {type:"v3", value: {x:1,y:1,z:1}},
    //     HemisphereLight: {
    //       type: "struct",
    //       value: {
    //         direction: {
    //           type: "v3",
    //           value: {x: 0,y:1,z:0},
    //         },
    //         skyColor: {
    //           type: "v3",
    //           value: {x: 1,y:1,z:1},
    //         },
    //         groundColor: {
    //           type: "v3",
    //           value: {x: 0,y:0,z:0},
    //         },
    //         specularColor: {
    //           type: "v4",
    //           value: {x: 1,y:1,z:1,w: 64},
    //         }
    //       }
    //     }
    //   }
    // }

  const mat = new LMGL.Material(matInfo);
  let mesh = new LMGL.Mesh(geo, mat);
   stage.addUpdate("loop",()=>{
    // mesh.rotation.y += 0.5;
  })
  stage.add(mesh)
  stage.run()
}

  </script>
</body>
</html>
